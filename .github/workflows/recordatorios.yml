name: Enviar Recordatorios de Citas

on:
  schedule:
    # Ejecutar cada 5 minutos
    - cron: '*/5 * * * *'
  
  # Para ejecutar manualmente desde GitHub
  workflow_dispatch:

env:
  SUPABASE_URL: https://nllllvztipbrhryzxamm.supabase.co

jobs:
  enviar-recordatorios:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Descargar el c√≥digo del repositorio
      - name: Checkout c√≥digo
        uses: actions/checkout@v3
      
      # 2. Configurar zona horaria (Yucat√°n)
      - name: Configurar zona horaria
        run: |
          echo "üïê Configurando zona horaria de Yucat√°n..."
          echo "Hora actual: $(TZ='America/Merida' date)"
      
      # 3. Instalar dependencias necesarias
      - name: Instalar dependencias
        run: |
          sudo apt-get update
          sudo apt-get install -y jq curl swaks
          echo "‚úÖ Dependencias instaladas"
      
      # 4. Ejecutar el script de recordatorios
      - name: Ejecutar script de recordatorios
        env:
          # Secrets que configurar√°s en GitHub
          SUPABASE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          GMAIL_USER: ${{ secrets.GMAIL_USER }}
          GMAIL_APP_PASSWORD: ${{ secrets.GMAIL_APP_PASSWORD }}
        run: |
          echo "üöÄ Iniciando proceso de recordatorios..."
          echo "Usando:"
          echo "  - Supabase: $SUPABASE_URL"
          echo "  - Gmail: $GMAIL_USER"
          
          # Dar permisos de ejecuci√≥n al script
          chmod +x ./enviar_recordatorios.sh
          
          # Ejecutar el script
          ./enviar_recordatorios.sh